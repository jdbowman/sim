About the gsm:
This subdir consists of programs to make all-sky diffuse backgrounds for MAPS. It should be made automatically when make
is invoked from the parent directory, but you can also "make install" in this directory.

Components:
gsm.f: This is Angelica de Oliveira-Costa's program to take her prinicple component analysis models of the sky and make
a model sky at any freq. Currently this is compiled into a program called "diffuse_sky".
convert_hpx: this is program to take the text format GSM HealPix output of "gsm.f" and convert it into a Plan-carre all sky map


Example to make an all-sky map at 150MHz:
> diffuse_sky
   Frequency at which to make a map (in MHz)?
  150
   Name of file in which to save the map?
  test150

the program runs and makes the output file "test150".

next, convert to a FITS file:

> convert_hpx -i test150 -o test150.fits
  Read in 3145729 pixels
  Which implies nside of 512 pixels
  We are assuming ring format GSM data
  Nearest neighbour matching..done.

this generates a file called "test150.fits", which is an all-sky Plan-carre map. This file can be used in maps_makesky
to project into a sine-projected hemisphere image. After this you can delete the "test150" file.

ADVANCED
========

All-Sky diffuse polarisation maps based on WMAP K-Band data

From scratch
============


1) Getting the WMAP data in the right format

Download the WMAP K-BAND data from lamda.gsfc.nasa.gov

I suggest the "smoothed I,Q,U Maps per Frequency band"

As these are produced by the CMB community they are HEALPIX Binary tables. There are 4 of them in the file
(I,Q,U,NOBS) 

You can export them to FITS-HPX format using an adapted HPXcvt

HPXcvt -b[1|2|3|4] <wmap_file> <HPXFILE_(I|Q|U|NOBS)>

The above is run 4 times to produce the I,Q,U,NOBS files from the data

2) Calculating the PA and fractional poln

This uses a program called wmap_pol which generates a fractional poln file and PA file from the 
wmap data

It outputs polarised sky at any frequency.

First generate a diffuse sky using Angelica's code

>diffuse_sky

follow the prompts


>convert_hpx -f <freq> -F -i <angelica> -o <healpix.fits>
>HPXcvt healpix.fits hpx.fits
This produces a HPX fits file in exactly the same format as the output from step (1) above

then we run wmap_pol

>wmap_pol -I <hpx.fits> -i <wmap_root> -o <output_root>

this will produce: output_root_I.fits,_Q,_U,_V, PA and DEG files

These are used as a "backlight" that is propagated through the faraday screen generated by the scilab anf fortran code in the Faraday
directory.

You do not have to worry about building the screen as a fits file will be included - but as this is ~26 MB and as a back up I've decided to add the scilab and 
Fortran code used to build the Faraday screen




